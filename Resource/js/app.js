
    DataGuanajuatoState  = [
        {id:"11001", COUNTYID:"001", COUNTY:"Abasolo",                                           STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11002", COUNTYID:"002", COUNTY:"Acámbaro",                                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11003", COUNTYID:"003", COUNTY:"San Miguel de Allende",                             STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11005", COUNTYID:"005", COUNTY:"Apaseo el Grande",                                  STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11004", COUNTYID:"004", COUNTY:"Apaseo el Alto",                                    STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11006", COUNTYID:"006", COUNTY:"Atarjea",                                           STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11007", COUNTYID:"007", COUNTY:"Celaya",                                            STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11008", COUNTYID:"008", COUNTY:"Manuel Doblado",                                    STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11009", COUNTYID:"009", COUNTY:"Comonfort",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11010", COUNTYID:"010", COUNTY:"Coroneo",                                           STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11011", COUNTYID:"011", COUNTY:"Cortazar",                                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11012", COUNTYID:"012", COUNTY:"Cuerámaro",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11013", COUNTYID:"013", COUNTY:"Doctor Mora",                                       STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11014", COUNTYID:"014", COUNTY:"Dolores Hidalgo Cuna de la Independencia Nacional", STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11015", COUNTYID:"015", COUNTY:"Guanajuato",                                        STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11016", COUNTYID:"016", COUNTY:"Huanímaro",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11017", COUNTYID:"017", COUNTY:"Irapuato",                                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11018", COUNTYID:"018", COUNTY:"Jaral del Progreso",                                STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11019", COUNTYID:"019", COUNTY:"Jerécuaro",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11020", COUNTYID:"020", COUNTY:"León",                                              STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11021", COUNTYID:"021", COUNTY:"Moroleón",                                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11022", COUNTYID:"022", COUNTY:"Ocampo",                                            STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11023", COUNTYID:"023", COUNTY:"Pénjamo",                                           STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11024", COUNTYID:"024", COUNTY:"Pueblo Nuevo",                                      STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11025", COUNTYID:"025", COUNTY:"Purí­sima del Rincón",                               STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11026", COUNTYID:"026", COUNTY:"Romita",                                            STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11027", COUNTYID:"027", COUNTY:"Salamanca",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11028", COUNTYID:"028", COUNTY:"Salvatierra",                                       STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11029", COUNTYID:"029", COUNTY:"San Diego de la Unión",                             STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11030", COUNTYID:"030", COUNTY:"San Felipe",                                        STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11031", COUNTYID:"031", COUNTY:"San Francisco del Rincón",                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11032", COUNTYID:"032", COUNTY:"San José Iturbide",                                 STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11033", COUNTYID:"033", COUNTY:"San Luis de la Paz",                                STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11034", COUNTYID:"034", COUNTY:"Santa Catarina",                                    STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11035", COUNTYID:"035", COUNTY:"Santa Cruz de Juventino Rosas",                     STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11036", COUNTYID:"036", COUNTY:"Santiago Maravatí­o",                                STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11037", COUNTYID:"037", COUNTY:"Silao de la Victoria",                              STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11038", COUNTYID:"038", COUNTY:"Tarandacuao",                                       STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11039", COUNTYID:"039", COUNTY:"Tarimoro",                                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11040", COUNTYID:"040", COUNTY:"Tierra Blanca",                                     STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11041", COUNTYID:"041", COUNTY:"Uriangato",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11042", COUNTYID:"042", COUNTY:"Valle de Santiago",                                 STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11043", COUNTYID:"043", COUNTY:"Victoria",                                          STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11044", COUNTYID:"044", COUNTY:"Villagrán",                                         STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" },
        {id:"11045", COUNTYID:"045", COUNTY:"Xichú",                                             STATEID:"11", STATE:"Guanajuato", CNTRY:"Peru",  },
        {id:"11046", COUNTYID:"046", COUNTY:"Yuriria",                                           STATEID:"11", STATE:"Guanajuato", CNTRY:"Mexico" } 
    ]

    ColorPalette = {
        Blue: [{
            Range1: "#bbdefb",
            Range2: "#64b5f6",
            Range3: "#1976d2",
            Range4: "#0d47a1"
        }],
        Purple: [{
            Range1: "#e1bee7",
            Range2: "#ce93d8",
            Range3: "#7b1fa2",
            Range4: "#4a148c",
            Range5: "#4a148c"
        }],
        Green: [{
            Range1: "#c8e6c9",
            Range2: "#a5d6a7",
            Range3: "#66bb6a",
            Range4: "#43a047",
            Range5: "#2e7d32",
            Range6: "#1b5e20"
        }],
        Brown: [{
            Range1: "#d7ccc8",
            Range2: "#a1887f",
            Range3: "#6d4c41",
            Range4: "#4e342e",
        }],
        Blue_Grey: [{
            Range1: "#eceff1",
            Range2: "#b0bec5",
            Range3: "#78909c",
            Range4: "#546e7a",
            Range5: "#37474f",
            Range6: "#263238",
        }],
        Teal: [{
            Range1: "#b2dfdb",
            Range2: "#4db6ac",
            Range3: "#00897b",
            Range4: "#004d40",
        }],
        Cyan: [{
            Range1: "#80deea",
            Range2: "#00bcd4",
            Range3: "#0097a7",
            Range4: "#006064",
        }],
        Indigo: [{
            Range1: "#c5cae9",
            Range2: "#7986cb",
            Range3: "#5c6bc0",
            Range4: "#283593",
            Range5: "#1a237e",
        }]
    }

    var server_dir = "https://script.google.com/macros/s/AKfycbxA91vlseiaEC7fJfHXmKPTS9aQHutPBdx8EAdkVAztsN1cuQad2hZQbi9GK7skYJ_kPw/exec";
    //  GENERACIÓN AUTOMÁTICA DE CATEGORÍAS
    function Object2Vector(ObjectPropertie){
        var vector = [];

        if ( ObjectPropertie == "Analfabetismo" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AnalfabetismoIndex);
        else if ( ObjectPropertie == "AbsorcionSecundaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbsorcionSecundaria);
        else if( ObjectPropertie == "AbsorcionMS" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbsorcionMS);
        else if( ObjectPropertie == "AbsorcionSuperior" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbsorcionSuperior);
        else if( ObjectPropertie == "NumHabitantes" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseInt(DataGuanajuatoStates[i].NumHabitantes);
        else if( ObjectPropertie == "CoberturaPreescolar" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].CoberturaPreescolar);
        else if( ObjectPropertie == "CoberturaPrimaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].CoberturaPrimaria);
        else if( ObjectPropertie == "CoberturaSecundaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].CoberturaSecundaria);
        else if( ObjectPropertie == "CoberturaMediaSuperior" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].CoberturaMediaSuperior);
        else if( ObjectPropertie == "CoberturaSuperior" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].CoberturaSuperior);
        else if( ObjectPropertie == "IndiceReprobacionPrimaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].IndiceReprobacionPrimaria);
        else if( ObjectPropertie == "IndiceReprobacionSecundaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].IndiceReprobacionSecundaria);
        else if( ObjectPropertie == "IndiceReprobacionMS" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].IndiceReprobacionMS);
        else if( ObjectPropertie == "EficienciaTerminalPrimaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].EficienciaTerminalPrimaria);
        else if( ObjectPropertie == "EficienciaTerminalSecundaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].EficienciaTerminalSecundaria);
        else if( ObjectPropertie == "EficienciaTerminalMediaSuperior" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].EficienciaTerminalMediaSuperior);
        else if( ObjectPropertie == "AbandonoEscolarPrimaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbandonoEscolarPrimaria);
        else if( ObjectPropertie == "AbandonoEscolarSecundaria" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbandonoEscolarSecundaria);
        else if( ObjectPropertie == "AbandonoEscolarMediaSuperior" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbandonoEscolarMediaSuperior);
        else if( ObjectPropertie == "AbandonoEscolarSuperior" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].AbandonoEscolarSuperior);
        else if( ObjectPropertie == "RezagoSocial" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].RezagoSocial);
        else if( ObjectPropertie == "IDH" )
            for(var i=0; i<DataGuanajuatoStates.length; i++)
                vector[i] = parseFloat(DataGuanajuatoStates[i].IDH);
                    
        return vector;
    }

    function AverageOfSet(Vector){
        var sum = 0;

        for(var i=0; i<Vector.length; i++)
            sum += Vector[i];

        return sum/Vector.length;
    }

    function MaxOfSet(Vector){
        var max = 0, value = 0;

        for(var i=0; i<Vector.length; i++){
            value = Vector[i];

            if( value >= max ) 
                max = value;
        }
        
        return max;
    }

    function MinOfSet(Vector){
        var min = MaxOfSet(Vector), value = 0;

        for(var i=0; i<Vector.length; i++){
            value = Vector[i];

            if( value <= min )
                min = value;
        }
        
        return min;
    }

    // CREANDO CATEGORÍAS Y ETIQUETAS POR CATEGORÍA
    function CreateLabelsByCategory(chart, sX, ids, LabelsColor){
        // Create map polygon series
        sX.calculateVisualCenter = true;
        
        // Configure label series
        var labelSeries = chart.series.push(new am4maps.MapImageSeries());
        var labelTemplate = labelSeries.mapImages.template.createChild(am4core.Label);
        labelTemplate.horizontalCenter = "middle";
        labelTemplate.verticalCenter = "middle";
        labelTemplate.fontSize = 11;
        labelTemplate.interactionsEnabled = false;
        labelTemplate.nonScaling = false;
        
        //  Asignando nombres a las etiquedas por municipio
        sX.events.on("inited", function () {
            for(var i = 0; i < ids.length; i++){
                var polygon = sX.getPolygonById( ids[i] );

                if( polygon ){
                    var label = labelSeries.mapImages.create();
                    var state = polygon.dataItem.dataContext.COUNTY;
                    
                    if( state == 'San Felipe' ){                            //  1
                        name_state = '\n\n San Felipe';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 13;
                    }else if( state == 'San Diego de la Unión' ){           //  2
                        name_state = 'San Diego \n de la Unión';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'San Luis de la Paz' ){              //  3
                        name_state = 'San Luis \n de la Paz';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'Santa Catarina' ){                  //  4
                        name_state = 'Santa \n Catarina';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 10;
                    }else if( state == 'Tierra Blanca' ){                   //  5
                        name_state = 'Tierra \n Blanca';    
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'San José Iturbide' ){               //  6
                        name_state = 'San José \n Iturbide';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'San Miguel de Allende' ){           //  7
                        name_state = 'San Miguel \n de Allende';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 13;
                    }else if( state == 'Dolores Hidalgo Cuna de la Independencia Nacional' ){
                        name_state = 'Dolores Hidalgo \n Cuna de la \n Independencia \n Nacional';
                        label.children.getIndex(0).fill = LabelsColor;      //  8
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Silao de la Victoria' ){            //  9
                        name_state = 'Silao \n de la \n Victoria';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Purísima del Rincón' ){             //  10
                        name_state = 'Purísima \n del \n Rincón';
                        label.children.getIndex(0).fill = 'black';
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'San Francisco del Rincón' ){        //  11
                        name_state = 'San \n Francisco \n del \n Rincón';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Manuel Doblado' ){                  //  12
                        name_state = 'Manuel \n Doblado';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 13;
                    }else if( state == 'Santa Cruz de Juventino Rosas' ){   //  13
                        name_state = 'Santa \n Cruz de \n Juventino \n Rosas';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 10;
                    }else if( state == 'Valle de Santiago' ){               //  14
                        name_state = 'Valle de \n Santiago';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 13;
                    }else if( state == 'Jaral del Progreso' ){              //  15
                        name_state = 'Jaral del \n Progreso';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 10;
                    }else if( state == 'Santiago Maravatío' ){              //  16
                        name_state = 'Santiago \n Maravatío';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 10;
                    }else if( state == 'Ocampo' ){                          //  17
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'Uriangato' ){                       //  18
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Moroleón' ){                        //  19 
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Yuriria' ){                         //  20
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Acámbaro' ){                        //  21
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'Tarandacuao' ){                     //  22
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Jerécuaro' ){                       //  23
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Coroneo' ){                         //  24
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Tarimoro' ){                        //  25
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Cortazar' ){                        //  26
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Villagrán' ){                       //  27
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Celaya' ){                          //  28
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'Apaseo el Grande' ){                //  29
                        name_state = 'Apaseo el \nGrande';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Apaseo el Alto' ){                  //  30
                        name_state = 'Apaseo el \nAlto';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Comonfort' ){                       //  31
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Irapuato' ){                        //  32
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'Romita' ){                          //  33
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 12;
                    }else if( state == 'Pueblo Nuevo' ){                    //  34
                        name_state = 'Pueblo \nNuevo';
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 10;
                    }else if( state == 'Salvatierra' ){                     //  35
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Guanajuato' ){                      //  36
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'León' ){                            //  37
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Abasolo' ){                         //  38
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Pénjamo' ){                         //  39
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Huanímaro' ){                       //  40
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Cuerámaro' ){                       //  41
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Salamanca' ){                       //  42
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 10;
                    }else if( state == 'Doctor Mora' ){                     //  43
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Victoria' ){                        //  44
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Xichú' ){                           //  45
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }else if( state == 'Atarjea' ){                         //  46
                        name_state = state;
                        label.children.getIndex(0).fill = LabelsColor;
                        label.children.getIndex(0).fontSize = 11;
                    }

                    label.latitude = polygon.visualLatitude;
                    label.longitude = polygon.visualLongitude;
                    label.children.getIndex(0).text = name_state;
                    //label.children.getIndex(0).fill = 'white';
                }
            }
        });
    }

    function CreateCategory(chart, ids, ColorMap, MapLineColor){
        var SeriesChart = chart.series.push(new am4maps.MapPolygonSeries());
        SeriesChart.useGeodata = true;
        SeriesChart.include = ids;
        SeriesChart.mapPolygons.template.fill = am4core.color( ColorMap );
        SeriesChart.fill = am4core.color( ColorMap );

        var ptsSeries = SeriesChart.mapPolygons.template;
        ptsSeries.stroke = am4core.color(MapLineColor);

        return SeriesChart;
    }
    //  OBTENIENDO LA INFORMACIÓN DEL MAPA
    function getMapData(){

        var MapData = [
                AbasoloValue = $('#txtAbasoloValue').val(),
                AcambaroValue = $('#txtAcambaroValue').val(),
                SanMiguelValue = $('#txtSanMiguelValue').val(),
                ApaseoElAltoValue = $('#txtApaseoElAltoValue').val(),
                ApaseoElGrandeValue = $('#txtApaseoElGrandeValue').val(),
                AtarjeaValue = $('#txtAtarjeaValue').val(),
                CelayaValue = $('#txtCelayaValue').val(),
                ManuelDobladoValue = $('#txtManuelDobladoValue').val(),
                ComonfortValue = $('#txtComonfortValue').val(),
                CoroneoValue = $('#txtCoroneoValue').val(),
                CortazarValue = $('#txtCortazarValue').val(),
                CueramaroValue = $('#txtCueramaroValue').val(),
                DoctorMoraValue = $('#txtDoctorMoraValue').val(),
                DoloresHidalgoValue = $('#txtDoloresHidalgoValue').val(),
                GuanajuatoValue = $('#txtGuanajuatoValue').val(),
                HuanimaroValue = $('#txtHuanimaroValue').val(),
                IrapuatoValue = $('#txtIrapuatoValue').val(),
                JaralDelProgesoValue = $('#txtJaralDelProgesoValue').val(),
                JerecuaroValue = $('#txtJerecuaroValue').val(),
                LeonValue = $('#txtLeonValue').val(),
                MoroleonValue = $('#txtMoroleonValue').val(),
                OcampoValue = $('#txtOcampoValue').val(),
                PenjamoValue = $('#txtPenjamoValue').val(),
                PuebloNuevoValue = $('#txtPuebloNuevoValue').val(),
                PurisimaDelRinconValue = $('#txtPurisimaDelRinconValue').val(),
                RomitaValue = $('#txtRomitaValue').val(),
                SalamancaValue = $('#txtSalamancaValue').val(),
                SalvatierraValue = $('#txtSalvatierraValue').val(),
                SanDiegoDeLaUnionValue = $('#txtSanDiegoDeLaUnionValue').val(),
                SanFelipeValue = $('#txtSanFelipeValue').val(),
                SanFranciscoDelRinconValue = $('#txtSanFranciscoDelRinconValue').val(),
                SanJoseIturbideValue = $('#txtSanJoseIturbideValue').val(),
                SanLuisDeLaPazValue = $('#txtSanLuisDeLaPazValue').val(),
                SantaCatarinaValue = $('#txtSantaCatarinaValue').val(),
                JuventinoRosasValue = $('#txtSantaCruzDeJuventinoRosasValue').val(),
                SantiagoMaravatíoValue = $('#txtSantiagoMaravatíoValue').val(),
                SilaoValue = $('#txtSilaoValue').val(),
                TarandacuaoValue = $('#txtTarandacuaoValue').val(),
                TarimoroValue = $('#txtTarimoroValue').val(),
                TierraBlancaValue = $('#txtTierraBlancaValue').val(),
                UriangatoValue = $('#txtUriangatoValue').val(),
                ValleDeSantiagoValue = $('#txtValleDeSantiagoValue').val(),
                VictoriaValue = $('#txtVictoriaValue').val(),
                VillagranValue = $('#txtVillagranValue').val(),
                XichuValue = $('#txtXichuValue').val(),
                YuririaValue = $('#txtYuririaValue').val()
        ]

        return MapData;
    }

    function getMapColor(){
        var selected_color = $('input:radio[name=group1]:checked').val();
        var CategoriesColor;
        console.log( selected_color );

        if( selected_color == "blue-gray" ){
            CategoriesColor = ColorPalette.Blue_Grey;
        }else if( selected_color == "brown" ){
            CategoriesColor = ColorPalette.Brown;
        }else if( selected_color == "green" ){
            CategoriesColor = ColorPalette.Green;
        }else if( selected_color == "teal" ){
            CategoriesColor = ColorPalette.Teal;
        }else if( selected_color == "cyan" ){
            CategoriesColor = ColorPalette.Cyan;
        }else if( selected_color == "blue" ){
            CategoriesColor = ColorPalette.Blue;
        }else if( selected_color == "indigo" ){
            CategoriesColor = ColorPalette.Indigo;
        }else if( selected_color == "purple" ){
            CategoriesColor = ColorPalette.Purple;
        }

        $('.color-category1').css({
            'background-color': CategoriesColor[0].Range1
        });

        $('.color-category2').css({
            'background-color': CategoriesColor[0].Range2
        });

        $('.color-category3').css({
            'background-color': CategoriesColor[0].Range3
        });

        $('.color-category4').css({
            'background-color': CategoriesColor[0].Range4
        });

        return CategoriesColor;
    }

    function getNameCategories(){
        var CategoriesName = {
            Category1: $('#txtCategory1').val(),
            Category2: $('#txtCategory2').val(),
            Category3: $('#txtCategory3').val(),
            Category4: $('#txtCategory4').val(),
        }

        return CategoriesName;
    }

    function getCategoriesValues(){
        var Categories = {
            Category1: {Min: $('#txtCategory1_Min').val(), Max: $('#txtCategory1_Max').val()},
            Category2: {Min: $('#txtCategory2_Min').val(), Max: $('#txtCategory2_Max').val()},
            Category3: {Min: $('#txtCategory3_Min').val(), Max: $('#txtCategory3_Max').val()},
            Category4: {Min: $('#txtCategory4_Min').val(), Max: $('#txtCategory4_Max').val()}
        }

        return Categories;
    }

    function getLabelsColorByCategory(){
        var switch1 = $('input:checkbox[name=switch-cat-1]').prop('checked');
        var switch2 = $('input:checkbox[name=switch-cat-2]').prop('checked');
        var switch3 = $('input:checkbox[name=switch-cat-3]').prop('checked');
        var switch4 = $('input:checkbox[name=switch-cat-4]').prop('checked');
        var lblColor1, lblColor2, lblColor3, lblColor4;

        if( switch1 ) lblColor1 = 'black'; else lblColor1 = 'white';
        if( switch2 ) lblColor2 = 'black'; else lblColor2 = 'white';
        if( switch3 ) lblColor3 = 'black'; else lblColor3 = 'white';
        if( switch4 ) lblColor4 = 'black'; else lblColor4 = 'white';
            

        LabelsColor = {
            LabelsCategory1: lblColor1,
            LabelsCategory2: lblColor2,
            LabelsCategory3: lblColor3,
            LabelsCategory4: lblColor4,
        }

        return LabelsColor;
    }

    function ChangeTitleCategoriesByLimits(){
        var checked = $('#checkbox-title-ranges').prop('checked');
        var usePorcentage = $('#checkbox-title-porcentage').prop('checked');
        var CatValues = getCategoriesValues();
        var symbolPorcentage;

        if( usePorcentage ){
            symbolPorcentage = ' %';
        }else{
            symbolPorcentage = '';
        }

        if( checked ){
            var lastCatName = {
                c1: $('#txtCategory1').val(), c2: $('#txtCategory2').val(), c3: $('#txtCategory3').val(), c4: $('#txtCategory4').val(),
            }

            $('#txtCategory1').val( CatValues.Category1.Min + symbolPorcentage + " - " + CatValues.Category1.Max + symbolPorcentage );
            $('#txtCategory1').attr('disabled', true);

            $('#txtCategory2').val( CatValues.Category2.Min + symbolPorcentage + " - " + CatValues.Category2.Max + symbolPorcentage );
            $('#txtCategory2').attr('disabled', true);

            $('#txtCategory3').val( CatValues.Category3.Min + symbolPorcentage + " - " + CatValues.Category3.Max + symbolPorcentage );
            $('#txtCategory3').attr('disabled', true);

            $('#txtCategory4').val( CatValues.Category4.Min + symbolPorcentage + " - " + CatValues.Category4.Max + symbolPorcentage );
            $('#txtCategory4').attr('disabled', true);

            localStorage.setItem( 'oldCategoryNames', JSON.stringify(lastCatName) );
        }else{
            var oldNames = JSON.parse( localStorage.getItem('oldCategoryNames') );

            $('#txtCategory1').val( oldNames.c1 );
            $('#txtCategory1').attr('disabled', false);
            
            $('#txtCategory2').val( oldNames.c2 );
            $('#txtCategory2').attr('disabled', false);
            
            $('#txtCategory3').val( oldNames.c3 );
            $('#txtCategory3').attr('disabled', false);
            
            $('#txtCategory4').val( oldNames.c4 );
            $('#txtCategory4').attr('disabled', false);
            
        }
    }

    // CREATING MAPS
    function CreateMap(MapData, MapColor, CategoriesName, CategoriesValues, LabelsColor){

//      Creamos la instancia del mapa
        var chart = am4core.create("mapa_guanajuato", am4maps.MapChart);
        chart.geodata = am4geodata_region_mexico_guaHigh;
        chart.projection = new am4maps.projections.Miller();
        chart.maxZoomLevel = 1;
        chart.seriesContainer.draggable = false;
        chart.seriesContainer.resizable = false;

//      Asignamos un color distinto para cada una de las regiones
        var s1_range = [], s2_range = [], s3_range = [], s4_range = [], s0_range = [], ids = [];

        var th1 = CategoriesValues.Category1.Min, th12 = CategoriesValues.Category1.Max;
        var th2 = CategoriesValues.Category2.Min, th22 = CategoriesValues.Category2.Max;
        var th3 = CategoriesValues.Category3.Min, th32 = CategoriesValues.Category3.Max;
        var th4 = CategoriesValues.Category4.Min, th42 = CategoriesValues.Category4.Max;

        for(var i=0; i<MapData.length; i++){
            var Map_data = MapData[i];

                if ( Map_data >= th1 && Map_data <= th12 )
                s1_range.push( DataGuanajuatoState[i].id );
            else if ( Map_data >= th2 && Map_data <= th22 )
                s2_range.push( DataGuanajuatoState[i].id );
            else if ( Map_data >= th3 && Map_data <= th32 )
                s3_range.push( DataGuanajuatoState[i].id );
            else if ( Map_data >= th4 && Map_data <= th42 )
                s4_range.push( DataGuanajuatoState[i].id );
            else if( Map_data == 0 )
                s0_range.push( DataGuanajuatoState[i].id )

            ids.push( DataGuanajuatoState[i].id );
        }

        var MapLineColor1 = "rgba(0, 0, 0, 0.3)";
        var MapLineColor2 = "rgba(0, 0, 0, 0.2)";
        var MapLineColor3 = "rgba(250, 250, 250, 0.5)";
        var MapLineColor4 = "rgba(250, 250, 250, 1)";
        var ColorMap     = MapColor;

        //  Creamos las categorías
        var s1 = CreateCategory(chart, s1_range, ColorMap[0].Range1, MapLineColor1);
        var s2 = CreateCategory(chart, s2_range, ColorMap[0].Range2, MapLineColor2);
        var s3 = CreateCategory(chart, s3_range, ColorMap[0].Range3, MapLineColor3);
        var s4 = CreateCategory(chart, s4_range, ColorMap[0].Range4, MapLineColor4);

        //  Asignamos los nombres a las etiquetas de cada municipio por categorías
        CreateLabelsByCategory( chart, s1, ids, LabelsColor.LabelsCategory1);
        CreateLabelsByCategory( chart, s2, ids, LabelsColor.LabelsCategory2);
        CreateLabelsByCategory( chart, s3, ids, LabelsColor.LabelsCategory3);
        CreateLabelsByCategory( chart, s4, ids, LabelsColor.LabelsCategory4);

        chart.legend = new am4maps.Legend();
        chart.legend.position = "right";
        chart.legend.align = "right";
        chart.legend.valign = "middle";

        chart.legend.data = [{
            "name": CategoriesName.Category1,
            "fill": ColorMap[0].Range1
            }, {
            "name": CategoriesName.Category2,
            "fill": ColorMap[0].Range2
            }, {
            "name": CategoriesName.Category3,
            "fill": ColorMap[0].Range3
            }, {
            "name": CategoriesName.Category4,
            "fill": ColorMap[0].Range4
            }
        ];

        //  Formato al indicador de las categorías
        var marker = chart.legend.markers.template.children.getIndex(0);
        marker.cornerRadius(12, 12, 12, 12);
        marker.strokeWidth = 2;
        marker.strokeOpacity = 0.6;
        marker.stroke = am4core.color("#ccc");
    }

    function UpdateAndShowMap(){
        ChangeTitleCategoriesByLimits();

        var MapData = getMapData();
        var MapColor = getMapColor();
        var CategoriesName = getNameCategories();
        var CategoriesValues = getCategoriesValues();
        var LabelsColor = getLabelsColorByCategory();

        CreateMap(MapData, MapColor, CategoriesName, CategoriesValues, LabelsColor);
    }

    function EmptyMap(){
        var chart = am4core.create("mapa_guanajuato", am4maps.MapChart);
        chart.geodata = am4geodata_region_mexico_guaHigh;
        chart.projection = new am4maps.projections.Miller();

        var ids = [], ids1 = [], ids2 = [];

        for(var i=0; i<DataGuanajuatoEmpty.length; i++){

            if( i <= 23 )
                ids1.push( DataGuanajuatoEmpty[i].id );
            else
                ids2.push( DataGuanajuatoEmpty[i].id );

            ids.push( DataGuanajuatoEmpty[i].id );
        }

        // Create map polygon series
        var polygonSeries = chart.series.push(new am4maps.MapPolygonSeries());
        polygonSeries.useGeodata = true;
        polygonSeries.calculateVisualCenter = true;

        // Configure label series
        var labelSeries = chart.series.push(new am4maps.MapImageSeries());
        var labelTemplate = labelSeries.mapImages.template.createChild(am4core.Label);
        labelTemplate.horizontalCenter = "middle";
        labelTemplate.verticalCenter = "middle";
        labelTemplate.fontSize = 11;
        labelTemplate.interactionsEnabled = false;
        labelTemplate.nonScaling = false;

        // Set up label series to populate
        polygonSeries.events.on("inited", function () {
            for(var i = 0; i < ids.length; i++){
                var polygon = polygonSeries.getPolygonById( ids[i] );

                if( polygon ){
                    var label = labelSeries.mapImages.create();
                    var state = polygon.dataItem.dataContext.COUNTY;
                    console.log( state );

                    if( state == 'San Diego de la Unión' ){
                        name_state = 'San Diego \n de la Unión';
                    }else if( state == 'San Luis de la Paz' ){
                        name_state = 'San Luis \n de la Paz';
                    }else if( state == 'Santa Catarina' ){
                        name_state = 'Santa \n Catarina';
                    }else if( state == 'Tierra Blanca' ){
                        name_state = 'Tierra \n Blanca';
                    }else if( state == 'San José Iturbide' ){
                        name_state = 'San José \n Iturbide';
                    }else if( state == 'San Miguel de Allende' ){
                        name_state = 'San Miguel \n de Allende';
                    }else if( state == 'Dolores Hidalgo Cuna de la Independencia Nacional' ){
                        name_state = 'Dolores Hidalgo \n Cuna de la \n Independencia \n Nacional';
                    }else if( state == 'Silao de la Victoria' ){
                        name_state = 'Silao \n de la \n Victoria';
                    }else if( state == 'Purísima del Rincón' ){
                        name_state = 'Purísima \n del \n Rincón';
                    }else if( state == 'San Francisco del Rincón' ){
                        name_state = 'San \n Francisco \n del \n Rincón';
                    }else if( state == 'Manuel Doblado' ){
                        name_state = 'Manuel \n Doblado';
                    }else if( state == 'Santa Cruz de Juventino Rosas' ){
                        name_state = 'Santa \n Cruz de \n Juventino \n Rosas';
                    }else if( state == 'Valle de Santiago' ){
                        name_state = 'Valle de \n Santiago';
                    }else if( state == 'Jaral del Progreso' ){
                        name_state = 'Jaral del \n Progreso';
                    }else if( state == 'Santiago Maravatío' ){
                        name_state = 'Santiago \n Maravatío';
                    }else{
                        name_state = state;
                    }

                    label.latitude = polygon.visualLatitude;
                    label.longitude = polygon.visualLongitude;
                    label.children.getIndex(0).text = name_state;
                }
            }
        });

        chart.legend = new am4maps.Legend();
        chart.legend.position = "right";
        chart.legend.align = "right";
        chart.legend.valign = "middle";
        chart.legend.data = [{
            "name": "2016",
            "fill":"#72A6B2"
            }, {
            "name": "2017",
            "fill": "#667E93"
            }, {
            "name": "2018",
            "fill": "#488BB2"
            }];

        var marker = chart.legend.markers.template.children.getIndex(0);
        marker.cornerRadius(12, 12, 12, 12);
        marker.strokeWidth = 2;
        marker.strokeOpacity = 0.6;
        marker.stroke = am4core.color("rgba(200, 200, 200, 0.1)");

        $('.title-map').text('Mapas estadísticos');
    }

    function Get_AllProjectsName(){
        console.log('Mostrando proyectos => ');
    
        $.post(server_dir, {TypeFunction: "AllProjectsName"}, function(DataResults){
            console.log( DataResults );            
        }).done(function(){
            console.log(' Correcto ');
        }).fail(function() {
            console.log(' Error ');
        });
    }

    $(function(){
        $('.sidenav').sidenav();
        $('.collapsible').collapsible();
        $('.tooltipped').tooltip();
        $('input:radio[name=group1]').prop('checked', 'checked');

        UpdateAndShowMap();
        Get_AllProjectsName();
    });

    $('.btnConvert2Image').on('click', function(){
        html2canvas( $('.card-map')[0] ).then(function(Mapa) {
            $('.card-map').append('<h2>Descargando imagen</h2>');
            return Canvas2Image.saveAsPNG(Mapa);
            //$(".response").append(canvas);
        }).then(function(){
            $('.card-map').append('<h2>Imagen descargada</h2>');
        });
    });

    // --- --- --- --- --- --- --- --- --- --- --- ---- --- --- --- 

    $('.txtCategoriesValues').on('change', function(){
        UpdateAndShowMap();
    });

    $('.txtValueCity').on('change', function(){
        UpdateAndShowMap();
    });

    $('#RadioButtons_CategoriesColor').on('change', function(){
        UpdateAndShowMap();
    });

    $('.switch').on('change', function(){
        UpdateAndShowMap();
    });

    $('#checkbox-title-ranges').on('click', function(){
        UpdateAndShowMap();
    });

    $('#checkbox-title-porcentage').on('click', function(){
        UpdateAndShowMap();
    });

    $('#txt-title').on('change keydown keyup', function(){
        $('.map-title').text( $('#txt-title').val() );
    });

    /* CONTROLES PARA INCREMENTAR O DECREMENTAR EL TAMAÑO DEL TÍTULO */
    $('#btn-more-size-title').on('click', function(){
        var size_title = parseInt( $('#txt-size-text').val().split(' ')[0] );
    
        if( size_title < 35 )
            size_title = size_title + 1;
        else
            M.toast({html: 'Max 35', classes: 'rounded'});

        $('.map-title').css('font-size', size_title, 'important');
        $('#txt-size-text').val(size_title);
    });

    $('#btn-less-size-title').on('click', function(){
        var size_title = parseInt( $('#txt-size-text').val().split(' ')[0] );

        if( size_title > 20 )
            size_title = size_title - 1;
        else
            M.toast({html: 'Min 20', classes: 'rounded'});
    
        $('.map-title').css('font-size', size_title, 'important');
        $('#txt-size-text').val(size_title);
    });

    /* CONTROLES PARA INCREMENTAR O DECREMENTAR EL NÚMERO DE CATEGORÍAS DEL MAPA
    $('#btn-more-categories').on('click', function(){
        var num_categories = parseInt( $('#txtNumCategories').val() );
        console.log( num_categories );

        if( num_categories < 6 ){
            num_categories = num_categories + 1;
        }else
            M.toast({html: 'Max 6', classes: 'rounded'});



        $('#txtNumCategories').val(num_categories);
    });

    $('#btn-less-categories').on('click', function(){
        var size_title = parseInt( $('#txtNumCategories').val() );

        if( size_title > 2 )
            size_title = size_title - 1;
        else
            M.toast({html: 'Min 2', classes: 'rounded'});
    
        $('#txtNumCategories').val(size_title);
    });
    */

    $('#checkboxTextBold').on('change', function(){
        var checked = $('#checkboxTextBold').prop('checked');

        if( checked )
            $('.map-title').css('font-weight', 'bold');
        else
            $('.map-title').css('font-weight', 'normal');
    });

    $('#checkboxTextItalic').on('change', function(){
        var checked = $('#checkboxTextItalic').prop('checked');

        if( checked )
            $('.map-title').css('font-style', 'italic');
        else
            $('.map-title').css('font-style', 'normal');
    });

    // ACTIVATE THE DIFFERENTS SIDEBARS
    $('.btn-format-title').on('click', function(){
        $('.collection-data').hide();
        $('.collection-title-format').show();
        $('.collection-map-color-palette').hide();
        $('.collection-map-categories').hide();
    });

    $('.btn-data-city').on('click', function(){
        $('.collection-data').show();
        $('.collection-title-format').hide();
        $('.collection-map-color-palette').hide();
        $('.collection-map-categories').hide();
    });

    $('.collection-map-categories-btn').on('click', function(){
        $('.collection-data').hide();
        $('.collection-title-format').hide();
        $('.collection-map-color-palette').hide();
        $('.collection-map-categories').show();
    });

    $('.btn-map-color-pallete').on('click', function(){
        $('.collection-data').hide();
        $('.collection-title-format').hide();
        $('.collection-map-color-palette').show();
        $('.collection-map-categories').hide();
    });



